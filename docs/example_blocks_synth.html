<!-- HTML header for doxygen 1.8.12-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>The BLOCKS SDK: BlocksSynth</title>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">The BLOCKS SDK
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('example_blocks_synth.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">BlocksSynth </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="blocks_synth_introduction"></a>
Introduction</h1>
<p>BlocksSynth is a JUCE application that turns your Lightpad into a simple monophonic synthesiser capable of playing 4 different waveshapes - sine, square, sawtooth and triangle.</p>
<p>Generate a Projucer project from the file located in the <code class="filename">examples/</code> folder, then navigate to the <code class="filename">BlocksSynthDemo/Builds/</code> directory and open the code project in your IDE of choice. Run the application and connect your Lightpad (if you do not know how to do this, see <a class="el" href="connecting_blocks.html">Connecting BLOCKS</a>) - it should now display a simple 5x5 grid where each pad plays a note in the chromatic scale using a sine wave starting from the bottom-left (C3). It is possible to play any of the 25 notes but for ease of use tonics (the root note of the scale) are highlighted in white and notes in the C-major scale are highlighted in green. When a note has been played it is possible to change the amplitude using touch pressure and to pitch bend between adjacent notes by sliding left and right. Pressing the mode button on the Lightpad will change to the waveshape selection screen where the currently selected waveshape is rendered on the LEDs and you can switch between the 4 different waveshapes by touching anywhere on the Block surface.</p>
<p>The concept of a BLOCKS topology and the methods for receiving callbacks from the <a class="el" href="classBlock.html" title="Represents an individual BLOCKS device.">Block</a> object are covered in the <a class="el" href="example_blocks_monitor.html">BlocksMonitor</a> example and the basic methods for displaying grids and setting LEDs on the Block are covered in the <a class="el" href="example_blocks_drawing.html">BlocksDrawing</a> example. This example will cover how to render custom programs on the <a class="el" href="classLEDGrid.html" title="Represents a 2D grid of LEDs on a block device.">LEDGrid</a> using the Littlefoot language and how to do some simple audio synthesis using data from the Lightpad.</p>
<h1><a class="anchor" id="blocks_synth_note_grid"></a>
Note Grid</h1>
<p>In the synthesiser mode the Lightpad displays a 5x5 grid constructed using the <a class="el" href="structDrumPadGridProgram.html">DrumPadGridProgram</a> class. The <code class="project_code">SynthGrid</code> struct handles the setup and layout of this grid and sets the colours of the pads to white for tonics, green for notes in the C major scale and black for notes that are not in the C major scale.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> constructGridFillArray()</div>
<div class="line">{</div>
<div class="line">    gridFillArray.clear();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> i = 0; i &lt; numRows; ++i)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">auto</span> j = 0; j &lt; numColumns; ++j)</div>
<div class="line">        {</div>
<div class="line">            <a class="code" href="structDrumPadGridProgram_1_1GridFill.html">DrumPadGridProgram::GridFill</a> fill;</div>
<div class="line"> </div>
<div class="line">            <span class="keyword">auto</span> padNum = (i * 5) + j;</div>
<div class="line"> </div>
<div class="line">            fill.<a class="code" href="structDrumPadGridProgram_1_1GridFill.html#a8209446ba4218dbc59e899bf8e29107b">colour</a> =  notes.contains (padNum) ? baseGridColour</div>
<div class="line">                                                   : tonics.contains (padNum) ? Colours::white</div>
<div class="line">                                                                              : Colours::black;</div>
<div class="line">            fill.<a class="code" href="structDrumPadGridProgram_1_1GridFill.html#a4ee0f13cd4b8f02d3e909d681a24194b">fillType</a> = DrumPadGridProgram::GridFill::FillType::gradient;</div>
<div class="line">            gridFillArray.add (fill);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="astructDrumPadGridProgram_1_1GridFill_html"><div class="ttname"><a href="structDrumPadGridProgram_1_1GridFill.html">DrumPadGridProgram::GridFill</a></div><div class="ttdoc">Set how each pad in the grid looks.</div><div class="ttdef"><b>Definition:</b> roli_DrumPadLEDProgram.h:57</div></div>
<div class="ttc" id="astructDrumPadGridProgram_1_1GridFill_html_a4ee0f13cd4b8f02d3e909d681a24194b"><div class="ttname"><a href="structDrumPadGridProgram_1_1GridFill.html#a4ee0f13cd4b8f02d3e909d681a24194b">DrumPadGridProgram::GridFill::fillType</a></div><div class="ttdeci">FillType fillType</div><div class="ttdef"><b>Definition:</b> roli_DrumPadLEDProgram.h:73</div></div>
<div class="ttc" id="astructDrumPadGridProgram_1_1GridFill_html_a8209446ba4218dbc59e899bf8e29107b"><div class="ttname"><a href="structDrumPadGridProgram_1_1GridFill.html#a8209446ba4218dbc59e899bf8e29107b">DrumPadGridProgram::GridFill::colour</a></div><div class="ttdeci">LEDColour colour</div><div class="ttdef"><b>Definition:</b> roli_DrumPadLEDProgram.h:72</div></div>
</div><!-- fragment --><p>The <code class="project_code">SynthGrid::getNoteNumberForPad()</code> method is called in the <code class="project_code">BlocksSynthDemo::touchChanged()</code> callback and returns the corresponding MIDI note number for a Touch coordinate on the Lightpad. This note number is then passed to the <code class="project_code">Audio</code> class to be played on the synthesiser.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> getNoteNumberForPad (<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">    <span class="keyword">auto</span> xIndex = x / 3;</div>
<div class="line">    <span class="keyword">auto</span> yIndex = y / 3;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 60 + ((4 - yIndex) * 5) + xIndex;</div>
<div class="line">}</div>
</div><!-- fragment --><p>When the application is run, the synthesiser note grid would look like this:</p>
<div class="image">
<img src="BlocksSynth_grid.JPG" alt=""/>
<div class="caption">
Synthesiser note grid</div></div>
<h1><a class="anchor" id="blocks_synth_waveshape_display"></a>
Waveshape Display</h1>
<p>In the waveshape selection mode the <a class="el" href="structBlock_1_1Program.html" title="A program that can be loaded onto a block.">Block::Program</a> is set to an instance of the WaveshapeProgram class <span class="comment">[1]</span>. This class inherits from Block::Program so that it can be loaded onto the LEDGrid and its LittleFoot program can be executed on the Lightpad.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> setLEDProgram (<a class="code" href="classBlock.html">Block</a>&amp; block)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (currentMode == waveformSelectionMode)</div>
<div class="line">    {</div>
<div class="line">        block.<a class="code" href="classBlock.html#ad8951bbdae475bfea2d9b28bb3688d0e">setProgram</a> (<span class="keyword">new</span> WaveshapeProgram (block));    <span class="comment">// [1]</span></div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (<span class="keyword">auto</span>* waveshapeProgram = getWaveshapeProgram())</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">//...</span></div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">//...</span></div>
<div class="line">}</div>
<div class="ttc" id="aclassBlock_html"><div class="ttname"><a href="classBlock.html">Block</a></div><div class="ttdoc">Represents an individual BLOCKS device.</div><div class="ttdef"><b>Definition:</b> roli_Block.h:31</div></div>
<div class="ttc" id="aclassBlock_html_ad8951bbdae475bfea2d9b28bb3688d0e"><div class="ttname"><a href="classBlock.html#ad8951bbdae475bfea2d9b28bb3688d0e">Block::setProgram</a></div><div class="ttdeci">virtual juce::Result setProgram(std::unique_ptr&lt; Program &gt;, ProgramPersistency persistency=ProgramPersistency::setAsTemp)=0</div><div class="ttdoc">Sets the Program to run on this block.</div></div>
</div><!-- fragment --><p>The class itself is relatively simple and contains a method to set which waveshape should be displayed <span class="comment">[2]</span>, a method to load the coordinates for each of the four waveshapes into the heap <span class="comment">[3]</span> and one pure virtual method overridden from Block::Program, the <a class="el" href="structBlock_1_1Program.html#a162fefdf847a319008d2384e97c492c4" title="Returns the LittleFoot program to execute on the BLOCKS device.">Block::Program::getLittleFootProgram()</a> method <span class="comment">[4]</span>. The heap is the area of shared memory that is used by the program to communicate with the host computer and the size of this memory is set using the <code class="project_code">#heapsize: XXX</code> directive where XXX is the number of bytes required <span class="comment">[5]</span>.</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>WaveshapeProgram : <span class="keyword">public</span> <a class="code" href="structBlock_1_1Program.html">Block::Program</a></div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    WaveshapeProgram (<a class="code" href="classBlock.html">Block</a>&amp; b) : Program (b) {}</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> setWaveshapeType (<a class="code" href="namespacelittlefoot.html#a911a40d805ef6667f7b9ea6842af3fe7">uint8</a> type) {...} <span class="comment">// [2]</span></div>
<div class="line">    <span class="keywordtype">void</span> generateWaveshapes() {...}          <span class="comment">// [3]</span></div>
<div class="line"> </div>
<div class="line">    String <a class="code" href="structBlock_1_1Program.html#a162fefdf847a319008d2384e97c492c4">getLittleFootProgram</a>() override   <span class="comment">// [4]</span></div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> R<span class="stringliteral">&quot;littlefoot(</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">        #heapsize: 256                       // [5]</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">        //...</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">        )littlefoot&quot;;</span></div>
<div class="line"><span class="stringliteral">    }</span></div>
<div class="line"><span class="stringliteral">    </span><span class="comment">//...</span></div>
<div class="ttc" id="anamespacelittlefoot_html_a911a40d805ef6667f7b9ea6842af3fe7"><div class="ttname"><a href="namespacelittlefoot.html#a911a40d805ef6667f7b9ea6842af3fe7">littlefoot::uint8</a></div><div class="ttdeci">unsigned char uint8</div><div class="ttdef"><b>Definition:</b> roli_LittleFootRunner.h:44</div></div>
<div class="ttc" id="astructBlock_1_1Program_html"><div class="ttname"><a href="structBlock_1_1Program.html">Block::Program</a></div><div class="ttdoc">A program that can be loaded onto a block.</div><div class="ttdef"><b>Definition:</b> roli_Block.h:242</div></div>
<div class="ttc" id="astructBlock_1_1Program_html_a162fefdf847a319008d2384e97c492c4"><div class="ttname"><a href="structBlock_1_1Program.html#a162fefdf847a319008d2384e97c492c4">Block::Program::getLittleFootProgram</a></div><div class="ttdeci">virtual juce::String getLittleFootProgram()=0</div><div class="ttdoc">Returns the LittleFoot program to execute on the BLOCKS device.</div></div>
</div><!-- fragment --><p>The string literal returned by the <code class="project_code">getLittleFootProgram()</code> function needs to be preceeded by the "R" prefix and enclosed between "littlefoot" delimiters in order to prevent the characters to be escaped in the program.</p>
<p>In the private section of <code class="project_code">WaveshapeProgram</code> the structure of the shared data heap is laid out with variables containing the offsets for each section and the total size (in bytes) that is required can be determined by adding the last set of bytes required to the last offset, which in this case is 136 + 45 = 181. The heap contains space for a variable that determines which waveshape type to display and the Y coordinates for 1.5 cycles of each of the four waveshapes.</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> constexpr <a class="code" href="namespacelittlefoot.html#a417dab5137c6d4ff4e23303f84099aa9">uint32</a> waveshapeType      = 0;   <span class="comment">// 1 byte</span></div>
<div class="line"><span class="keyword">static</span> constexpr <a class="code" href="namespacelittlefoot.html#a417dab5137c6d4ff4e23303f84099aa9">uint32</a> sineWaveOffset     = 1;   <span class="comment">// 1 byte * 45</span></div>
<div class="line"><span class="keyword">static</span> constexpr <a class="code" href="namespacelittlefoot.html#a417dab5137c6d4ff4e23303f84099aa9">uint32</a> squareWaveOffset   = 46;  <span class="comment">// 1 byte * 45</span></div>
<div class="line"><span class="keyword">static</span> constexpr <a class="code" href="namespacelittlefoot.html#a417dab5137c6d4ff4e23303f84099aa9">uint32</a> sawWaveOffset      = 91;  <span class="comment">// 1 byte * 45</span></div>
<div class="line"><span class="keyword">static</span> constexpr <a class="code" href="namespacelittlefoot.html#a417dab5137c6d4ff4e23303f84099aa9">uint32</a> triangleWaveOffset = 136; <span class="comment">// 1 byte * 45</span></div>
<div class="ttc" id="anamespacelittlefoot_html_a417dab5137c6d4ff4e23303f84099aa9"><div class="ttname"><a href="namespacelittlefoot.html#a417dab5137c6d4ff4e23303f84099aa9">littlefoot::uint32</a></div><div class="ttdeci">unsigned int uint32</div><div class="ttdef"><b>Definition:</b> roli_LittleFootRunner.h:48</div></div>
</div><!-- fragment --><p>The <code class="project_code">WaveshapeProgram::getLittleFootProgram()</code> method returns the LittleFoot program that will be executed on the BLOCKS device. The <code class="project_code"><a class="el" href="group__LittleFootFunctions.html#gac827b978aa122f136a14c198687ad80f" title="Use this method to draw the display.">repaint()</a></code> method of this program is called at approximately 25Hz and is used to draw the moving waveshape on the LEDs of the Lightpad.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="group__LittleFootFunctions.html#gac827b978aa122f136a14c198687ad80f">repaint</a>()</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="group__LittleFootFunctions.html#ga7900085e8a95e1301bde50558bdc56d7">fillRect</a> (0xff000000, 0, 0, 15, 15);    <span class="comment">// [6]</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> type = <a class="code" href="group__LittleFootFunctions.html#ga4f6a11f8e6311683eb91463434f31394">getHeapByte</a> (0);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> offset = 1 + (type * 45) + yOffset; <span class="comment">// [7]</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x = 0; x &lt; 15; ++x)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">int</span> y = <a class="code" href="group__LittleFootFunctions.html#ga4f6a11f8e6311683eb91463434f31394">getHeapByte</a> (offset + x);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (y == 255)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 15; ++i)</div>
<div class="line">                drawLEDCircle (x, i);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (x % 2 == 0)</div>
<div class="line">        {</div>
<div class="line">            drawLEDCircle (x, y);           <span class="comment">// [8]</span></div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (++yOffset == 30)                    <span class="comment">// [9]</span></div>
<div class="line">        yOffset = 0;</div>
<div class="line">}</div>
<div class="ttc" id="agroup__LittleFootFunctions_html_ga4f6a11f8e6311683eb91463434f31394"><div class="ttname"><a href="group__LittleFootFunctions.html#ga4f6a11f8e6311683eb91463434f31394">getHeapByte</a></div><div class="ttdeci">int getHeapByte(int byteIndex)</div><div class="ttdoc">Reads and returns the value of a single byte from the heap.</div></div>
<div class="ttc" id="agroup__LittleFootFunctions_html_ga7900085e8a95e1301bde50558bdc56d7"><div class="ttname"><a href="group__LittleFootFunctions.html#ga7900085e8a95e1301bde50558bdc56d7">fillRect</a></div><div class="ttdeci">void fillRect(int rgb, int x, int y, int width, int height)</div><div class="ttdoc">Fills a rectangle on the display with a specified colour.</div></div>
<div class="ttc" id="agroup__LittleFootFunctions_html_gac827b978aa122f136a14c198687ad80f"><div class="ttname"><a href="group__LittleFootFunctions.html#gac827b978aa122f136a14c198687ad80f">repaint</a></div><div class="ttdeci">void repaint()</div><div class="ttdoc">Use this method to draw the display.</div></div>
</div><!-- fragment --><p>Each time this method is called, it clears the LEDs by setting them all to black <span class="comment">[6]</span> then calculates the heap offset based on the waveshape type that has been set <span class="comment">[7]</span> and uses a <code class="code">for()</code> loop to iterate over the 15 LEDs on the X-axis and draw an LED 'circle' using the <code class="project_code">drawLEDCircle()</code> method at the corresponding Y coordinate for the selected waveshape <span class="comment">[8]</span>. The read position of the heap is offset using the <code class="project_code">yOffset</code> variable which is incremented each <code class="project_code"><a class="el" href="group__LittleFootFunctions.html#gac827b978aa122f136a14c198687ad80f" title="Use this method to draw the display.">repaint()</a></code> call and wraps back around when the end of the heap section for the selected waveshape is reached to draw a 'moving' waveshape <span class="comment">[9]</span>.</p>
<div class="image">
<img src="BlocksSynth_waveshape.gif" alt=""/>
<div class="caption">
A sine wave dispayed in the waveshape selection mode</div></div>
<h1><a class="anchor" id="blocks_synth_audio"></a>
Audio</h1>
<p>The <code class="project_code">Audio</code> class handles the audio synthesis for this application and overrides the AudioIODeviceCallback::audioDeviceIOCallback() method to call the Synthesiser::renderNextBlock() method of a Synthesiser object.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> audioDeviceIOCallback (<span class="keyword">const</span> <span class="keywordtype">float</span>** <span class="comment">/*inputChannelData*/</span>, <span class="keywordtype">int</span> <span class="comment">/*numInputChannels*/</span>,</div>
<div class="line">                            <span class="keywordtype">float</span>** outputChannelData, <span class="keywordtype">int</span> numOutputChannels, <span class="keywordtype">int</span> numSamples)<span class="keyword"> override</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">    AudioBuffer&lt;float&gt; sampleBuffer (outputChannelData, numOutputChannels, numSamples);</div>
<div class="line">    sampleBuffer.clear();</div>
<div class="line"> </div>
<div class="line">    synthesiser.renderNextBlock (sampleBuffer, MidiBuffer(), 0, numSamples);</div>
<div class="line">}</div>
</div><!-- fragment --><p>This object is initialised to be capable of rendering sine, square, sawtooth and triangle waves on separate MIDI channels in the constructor of <code class="project_code">Audio</code>, and <code class="project_code">Audio</code> contains methods for sending note on, note off, channel pressure and pitch wheel messages to the Synthesiser.</p>
<div class="fragment"><div class="line">Audio()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">//...</span></div>
<div class="line">    synthesiser.clearVoices();</div>
<div class="line">    synthesiser.clearSounds();</div>
<div class="line"> </div>
<div class="line">    synthesiser.addVoice (<span class="keyword">new</span> SineVoice());</div>
<div class="line">    synthesiser.addVoice (<span class="keyword">new</span> SquareVoice());</div>
<div class="line">    synthesiser.addVoice (<span class="keyword">new</span> SawVoice());</div>
<div class="line">    synthesiser.addVoice (<span class="keyword">new</span> TriangleVoice());</div>
<div class="line"> </div>
<div class="line">    synthesiser.addSound (<span class="keyword">new</span> SineSound());</div>
<div class="line">    synthesiser.addSound (<span class="keyword">new</span> SquareSound());</div>
<div class="line">    synthesiser.addSound (<span class="keyword">new</span> SawSound());</div>
<div class="line">    synthesiser.addSound (<span class="keyword">new</span> TriangleSound());</div>
<div class="line">}</div>
</div><!-- fragment --><p>When a note is triggered on the Lightpad, the <code class="project_code">Audio::noteOn()</code> method is called with 3 arguments: a MIDI channel corresponding to the waveshape that should be generated, a MIDI note number and an initial velocity.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> noteOn (<span class="keywordtype">int</span> channel, <span class="keywordtype">int</span> noteNum, <span class="keywordtype">float</span> velocity)</div>
<div class="line">{</div>
<div class="line">    synthesiser.noteOn (channel, noteNum, velocity);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> noteOff (<span class="keywordtype">int</span> channel, <span class="keywordtype">int</span> noteNum, <span class="keywordtype">float</span> velocity)</div>
<div class="line">{</div>
<div class="line">    synthesiser.noteOff (channel, noteNum, velocity, <span class="keyword">false</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> allNotesOff()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> i = 1; i &lt; 5; ++i)</div>
<div class="line">        synthesiser.allNotesOff (i, <span class="keyword">false</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><p>Whilst the note is playing, the amplitude and pitch are modulated by calling the <code class="project_code">Audio::pressureChange()</code> and <code class="project_code">Audio::pitchChange()</code> methods from the <code class="project_code">BlocksSynthDemo::touchChanged()</code> callback. The pressure value of the Touch instance is used to directly control the Synthesiser amplitude and the distance from the initial note trigger on the X-axis of the Lightpad is scaled to +/-1.0 and used to modulate the frequency of the currently playing note.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> pressureChange (<span class="keywordtype">int</span> channel, <span class="keywordtype">float</span> newPressure)</div>
<div class="line">{</div>
<div class="line">    synthesiser.handleChannelPressure (channel, <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span> (newPressure * 127));</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> pitchChange (<span class="keywordtype">int</span> channel, <span class="keywordtype">float</span> pitchChange)</div>
<div class="line">{</div>
<div class="line">    synthesiser.handlePitchWheel (channel, <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span> (pitchChange * 127));</div>
<div class="line">}</div>
</div><!-- fragment --><p>The <code class="project_code">Oscillator</code> base class contains the waveshape rendering code which inherits from SynthesiserVoice and has a pure virtual <code class="project_code">Oscillator::renderWaveShape()</code> method that is overridden by subclasses to render the 4 different waveshapes.</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>OscillatorBase   : <span class="keyword">public</span> SynthesiserVoice</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="comment">//...</span></div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> canPlaySound (SynthesiserSound*) <span class="keyword">override</span> = 0;</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">double</span> renderWaveShape (<span class="keyword">const</span> <span class="keywordtype">double</span> currentPhase) = 0;</div>
<div class="line">    <span class="comment">//...</span></div>
</div><!-- fragment --><h1><a class="anchor" id="blocks_synth_summary"></a>
Summary</h1>
<p>This tutorial and the accompanying code project have expanded on the topics covered by previous tutorials, showing you how to display more complex, custom programs on the LEDGrid using the LittleFoot language and how to control simple audio synthesis parameters using the Lightpad.</p>
<h1><a class="anchor" id="blocks_synth_see_also"></a>
See also</h1>
<ul>
<li><a class="el" href="example_blocks_monitor.html">BlocksMonitor</a></li>
<li><a class="el" href="example_blocks_drawing.html">BlocksDrawing</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<hr class="footer"/>
<address class="footer"><small>All content &copy ROLI Ltd.</small></address><br/>
</body>
</html>
