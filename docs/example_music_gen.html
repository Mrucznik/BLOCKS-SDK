<!-- HTML header for doxygen 1.8.12-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>The BLOCKS SDK: Music Gen</title>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">The BLOCKS SDK
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('example_music_gen.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Music Gen </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="music_gen_introduction"></a>
Introduction</h1>
<p>Develop a MIDI note music generator with interesting visuals on the Lightpad <a class="el" href="classBlock.html" title="Represents an individual BLOCKS device.">Block</a>.</p>
<p>Launch the BLOCKS CODE application and open the script called <code class="filename">MusicGen.littlefoot</code>. You can find the script in the <code class="filename">littlefoot/scripts/Example Scripts</code> folder. If you don't have the BLOCKS CODE IDE installed on your system, please refer to the section <a class="el" href="getting_started_with_blocks_code.html">Getting started with BLOCKS CODE</a> for help.</p>
<h1><a class="anchor" id="music_gen_initial_setup"></a>
Initial Setup</h1>
<p>Let's first start by defining global parameters for our app such as the speed, root note and chord for our music generator like so:</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">metadata</span> <span class="keyword">description</span>=<span class="stringliteral">&quot;Music Gen - Tap to create an emitter, tap again to change its direction. Mode button resets.&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">variables</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">variable</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;speed&quot;</span>    <span class="keyword">displayName</span>=<span class="stringliteral">&quot;Speed&quot;</span>     <span class="keyword">type</span>=<span class="stringliteral">&quot;float&quot;</span>    <span class="keyword">min</span>=<span class="stringliteral">&quot;0&quot;</span> <span class="keyword">max</span>=<span class="stringliteral">&quot;5&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;1&quot;</span> /&gt;</div>
<div class="line">        &lt;<span class="keywordtype">variable</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;rootNote&quot;</span> <span class="keyword">displayName</span>=<span class="stringliteral">&quot;Root Note&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;midiNote&quot;</span> <span class="keyword">value</span>=<span class="stringliteral">&quot;C1&quot;</span> /&gt;</div>
<div class="line">        &lt;<span class="keywordtype">variable</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;chord&quot;</span>    <span class="keyword">displayName</span>=<span class="stringliteral">&quot;Chord&quot;</span>     <span class="keyword">type</span>=<span class="stringliteral">&quot;option&quot;</span>   <span class="keyword">value</span>=<span class="stringliteral">&quot;Major&quot;</span> <span class="keyword">options</span>=<span class="stringliteral">&quot;Major;Minor&quot;</span> /&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">variables</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">metadata</span>&gt;</div>
</div><!-- fragment --><p>We also need to define global variables such as colours, bullet direction and coordinates, blob direction and coordinates as well as the last note played and the number of note generators on the screen.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> green;</div>
<div class="line"><span class="keywordtype">int</span> red;</div>
<div class="line"><span class="keywordtype">int</span> blue;</div>
<div class="line"><span class="keywordtype">int</span> yellow;</div>
<div class="line"><span class="keywordtype">int</span> count;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">float</span> bullet1x;</div>
<div class="line"><span class="keywordtype">float</span> bullet1y;</div>
<div class="line"><span class="comment">//...</span></div>
<div class="line"><span class="keywordtype">int</span> bullet1d;</div>
<div class="line"><span class="comment">//...</span></div>
<div class="line"><span class="keywordtype">int</span> blob1x;</div>
<div class="line"><span class="keywordtype">int</span> blob1y;</div>
<div class="line"><span class="comment">//...</span></div>
<div class="line"><span class="keywordtype">int</span> blob1d;</div>
<div class="line"><span class="comment">//...</span></div>
<div class="line"><span class="keywordtype">int</span> lastNote1;</div>
<div class="line"><span class="comment">//...</span></div>
</div><!-- fragment --><p>In the <a class="el" href="group__LittleFootFunctions.html#ga18abf8b19283101238a77c9e6865b673" title="Called when a program is loaded onto the block and is about to start.">initialise()</a> function of our script, we first clear the display and send a MIDI CC message to turn all MIDI notes off thus resetting both the visual and audio states of the app. We also initialise all the variables to default values and set the colours we want to use.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="group__LittleFootFunctions.html#ga18abf8b19283101238a77c9e6865b673">initialise</a>()</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="group__LittleFootFunctions.html#gafaa5f070126ac5184a648b484e7cf276">clearDisplay</a>();</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="group__LittleFootFunctions.html#ga3b62a8ad9c3d70ffb85d717b1ec2d202">sendCC</a> (0, 120, 127);</div>
<div class="line"> </div>
<div class="line">    blob1x = -99;</div>
<div class="line">    <span class="comment">//...</span></div>
<div class="line"> </div>
<div class="line">    blob1y = -99;</div>
<div class="line">    <span class="comment">//...</span></div>
<div class="line"> </div>
<div class="line">    blob1d = 3;</div>
<div class="line">    <span class="comment">//...</span></div>
<div class="line"> </div>
<div class="line">    bullet1x = -99;</div>
<div class="line">    <span class="comment">//...</span></div>
<div class="line"> </div>
<div class="line">    bullet1y = -99;</div>
<div class="line">    <span class="comment">//...</span></div>
<div class="line"> </div>
<div class="line">    green  = 0x2200FF00;</div>
<div class="line">    red    = 0x22FF0000;</div>
<div class="line">    blue   = 0x220000FF;</div>
<div class="line">    yellow = 0x22FFFF00;</div>
<div class="line"> </div>
<div class="line">    count = 0;</div>
<div class="line">}</div>
<div class="ttc" id="agroup__LittleFootFunctions_html_ga18abf8b19283101238a77c9e6865b673"><div class="ttname"><a href="group__LittleFootFunctions.html#ga18abf8b19283101238a77c9e6865b673">initialise</a></div><div class="ttdeci">void initialise()</div><div class="ttdoc">Called when a program is loaded onto the block and is about to start.</div></div>
<div class="ttc" id="agroup__LittleFootFunctions_html_ga3b62a8ad9c3d70ffb85d717b1ec2d202"><div class="ttname"><a href="group__LittleFootFunctions.html#ga3b62a8ad9c3d70ffb85d717b1ec2d202">sendCC</a></div><div class="ttdeci">void sendCC(int channel, int controller, int value)</div><div class="ttdoc">Sends a controller message.</div></div>
<div class="ttc" id="agroup__LittleFootFunctions_html_gafaa5f070126ac5184a648b484e7cf276"><div class="ttname"><a href="group__LittleFootFunctions.html#gafaa5f070126ac5184a648b484e7cf276">clearDisplay</a></div><div class="ttdeci">void clearDisplay()</div><div class="ttdoc">Clears the display and sets all the LEDs to black.</div></div>
</div><!-- fragment --><p>In order to reset the state of the music generator at anytime, we implement the <a class="el" href="group__LittleFootFunctions.html#ga855e263a16ef092ef1c4891d353e2e76" title="Called when a button is pushed.">handleButtonDown()</a> callback to initialise the state of the app when the side button of the Lightpad is pressed.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="group__LittleFootFunctions.html#ga855e263a16ef092ef1c4891d353e2e76">handleButtonDown</a> (<span class="keywordtype">int</span> index)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="group__LittleFootFunctions.html#ga18abf8b19283101238a77c9e6865b673">initialise</a>();</div>
<div class="line">}</div>
<div class="ttc" id="agroup__LittleFootFunctions_html_ga855e263a16ef092ef1c4891d353e2e76"><div class="ttname"><a href="group__LittleFootFunctions.html#ga855e263a16ef092ef1c4891d353e2e76">handleButtonDown</a></div><div class="ttdeci">void handleButtonDown(int index)</div><div class="ttdoc">Called when a button is pushed.</div></div>
</div><!-- fragment --><p>In the <a class="el" href="group__LittleFootFunctions.html#gac827b978aa122f136a14c198687ad80f" title="Use this method to draw the display.">repaint()</a> function we first clear the display and perform 4 sequential operations every time the screen is refreshed: paint blobs, draw bullets, update bullets and detect bullets. These functions are each defined later on.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="group__LittleFootFunctions.html#gac827b978aa122f136a14c198687ad80f">repaint</a>()</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="group__LittleFootFunctions.html#gafaa5f070126ac5184a648b484e7cf276">clearDisplay</a>();</div>
<div class="line"> </div>
<div class="line">    paintBlob (blob1x, blob1y, blob1d);</div>
<div class="line">    <span class="comment">//...</span></div>
<div class="line"> </div>
<div class="line">    drawBullet (bullet1x, bullet1y, blob1d);</div>
<div class="line">    <span class="comment">//...</span></div>
<div class="line"> </div>
<div class="line">    updateBullet1();</div>
<div class="line">    <span class="comment">//...</span></div>
<div class="line"> </div>
<div class="line">    detectBullet();</div>
<div class="line">}</div>
<div class="ttc" id="agroup__LittleFootFunctions_html_gac827b978aa122f136a14c198687ad80f"><div class="ttname"><a href="group__LittleFootFunctions.html#gac827b978aa122f136a14c198687ad80f">repaint</a></div><div class="ttdeci">void repaint()</div><div class="ttdoc">Use this method to draw the display.</div></div>
</div><!-- fragment --><h1><a class="anchor" id="music_gen_drawing_blobs_bullets"></a>
Drawing Blobs and Bullets</h1>
<p>Now let's take a look at drawing various elements on the screen. The blobs that start shooting the note bullets are drawn using the following <code class="project_code">paintBlob()</code> function:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> paintBlob (<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keywordtype">int</span> type)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (type == 0)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="group__LittleFootFunctions.html#ga7900085e8a95e1301bde50558bdc56d7">fillRect</a>  (green, x,     y - 1, 1, 2);</div>
<div class="line">        <a class="code" href="group__LittleFootFunctions.html#ga31ccd4d5e7a75f964f8b3a2d72ca2753">blendRect</a> (green, x - 1, y,     3, 1);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == 1)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="group__LittleFootFunctions.html#ga7900085e8a95e1301bde50558bdc56d7">fillRect</a>  (red, x, y,     2, 1);</div>
<div class="line">        <a class="code" href="group__LittleFootFunctions.html#ga31ccd4d5e7a75f964f8b3a2d72ca2753">blendRect</a> (red, x, y - 1, 1, 3);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == 2)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="group__LittleFootFunctions.html#ga7900085e8a95e1301bde50558bdc56d7">fillRect</a>  (blue, x,     y, 1, 2);</div>
<div class="line">        <a class="code" href="group__LittleFootFunctions.html#ga31ccd4d5e7a75f964f8b3a2d72ca2753">blendRect</a> (blue, x - 1, y, 3, 1);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == 3)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="group__LittleFootFunctions.html#ga7900085e8a95e1301bde50558bdc56d7">fillRect</a>  (yellow, x - 1, y,     2, 1);</div>
<div class="line">        <a class="code" href="group__LittleFootFunctions.html#ga31ccd4d5e7a75f964f8b3a2d72ca2753">blendRect</a> (yellow, x,     y - 1, 1, 3);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="agroup__LittleFootFunctions_html_ga31ccd4d5e7a75f964f8b3a2d72ca2753"><div class="ttname"><a href="group__LittleFootFunctions.html#ga31ccd4d5e7a75f964f8b3a2d72ca2753">blendRect</a></div><div class="ttdeci">void blendRect(int argb, int x, int y, int width, int height)</div><div class="ttdoc">Blends a rectangle on the display with a specified colour.</div></div>
<div class="ttc" id="agroup__LittleFootFunctions_html_ga7900085e8a95e1301bde50558bdc56d7"><div class="ttname"><a href="group__LittleFootFunctions.html#ga7900085e8a95e1301bde50558bdc56d7">fillRect</a></div><div class="ttdeci">void fillRect(int rgb, int x, int y, int width, int height)</div><div class="ttdoc">Fills a rectangle on the display with a specified colour.</div></div>
</div><!-- fragment --><p>Depending on the direction of the blob we decide to draw the shapes using different colours and we use the <a class="el" href="group__LittleFootFunctions.html#ga31ccd4d5e7a75f964f8b3a2d72ca2753" title="Blends a rectangle on the display with a specified colour.">blendRect()</a> function to blend the pixel of the overlapping coordinate. Similarly, we draw the bullets with the <code class="project_code">drawBullet()</code> function depending on the direction of the corresponding blob.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> drawBullet (<span class="keywordtype">float</span> x, <span class="keywordtype">float</span> y, <span class="keywordtype">int</span> d)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="group__LittleFootFunctions.html#ga3f4401a805df36a97162630acc4a6a69">fillPixel</a> (0xFF222222, <span class="keywordtype">int</span> (x), <span class="keywordtype">int</span> (y));</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (d == 0)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="group__LittleFootFunctions.html#ga3f4401a805df36a97162630acc4a6a69">fillPixel</a> (0xFFFFFF, <span class="keywordtype">int</span> (x), <span class="keywordtype">int</span> (y - 1));</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (d == 1)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="group__LittleFootFunctions.html#ga3f4401a805df36a97162630acc4a6a69">fillPixel</a> (0xFFFFFF, <span class="keywordtype">int</span> (x + 1), <span class="keywordtype">int</span> (y));</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (d == 2)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="group__LittleFootFunctions.html#ga3f4401a805df36a97162630acc4a6a69">fillPixel</a> (0xFFFFFF, <span class="keywordtype">int</span> (x), <span class="keywordtype">int</span> (y + 1));</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="group__LittleFootFunctions.html#ga3f4401a805df36a97162630acc4a6a69">fillPixel</a> (0xFFFFFF, <span class="keywordtype">int</span> (x - 1), <span class="keywordtype">int</span> (y));</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="agroup__LittleFootFunctions_html_ga3f4401a805df36a97162630acc4a6a69"><div class="ttname"><a href="group__LittleFootFunctions.html#ga3f4401a805df36a97162630acc4a6a69">fillPixel</a></div><div class="ttdeci">void fillPixel(int rgb, int x, int y)</div><div class="ttdoc">Sets a pixel to a specified colour with full alpha.</div></div>
</div><!-- fragment --><h1><a class="anchor" id="music_gen_handling_touch_events"></a>
Handling Touch Events</h1>
<p>Up until now, the script would not draw anything on the screen as touch events are not handled yet and default coordinates are set to be out of bounds with the screen coordinates. Let's implement the <code class="project_code"><a class="el" href="group__LittleFootFunctions.html#ga1037467281f60ab95f5e5a305a41e73b" title="Called when a touch event starts.">touchStart()</a></code> callback to process touch events.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="group__LittleFootFunctions.html#ga1037467281f60ab95f5e5a305a41e73b">touchStart</a> (<span class="keywordtype">int</span> touchIndex, <span class="keywordtype">float</span> x, <span class="keywordtype">float</span> y, <span class="keywordtype">float</span> z, <span class="keywordtype">float</span> vz)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> intX = int (x * 7);</div>
<div class="line">    <span class="keywordtype">int</span> intY = int (y * 7);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> touch = touchBlob (intX, intY);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (touch &gt;= 1)</div>
<div class="line">    {</div>
<div class="line">        changeBlob (touch);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (count &lt; 5)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (z &lt; 0.05)</div>
<div class="line">        {</div>
<div class="line">            assignBlob (intX, intY, count, 0);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (z &lt; 0.2)</div>
<div class="line">        {</div>
<div class="line">            assignBlob (intX, intY, count, 1);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (z &lt; 0.5)</div>
<div class="line">        {</div>
<div class="line">            assignBlob (intX, intY, count, 2);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            assignBlob (intX, intY, count, 3);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        ++count;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="agroup__LittleFootFunctions_html_ga1037467281f60ab95f5e5a305a41e73b"><div class="ttname"><a href="group__LittleFootFunctions.html#ga1037467281f60ab95f5e5a305a41e73b">touchStart</a></div><div class="ttdeci">void touchStart(int index, float x, float y, float z, float vz)</div><div class="ttdoc">Called when a touch event starts.</div></div>
</div><!-- fragment --><p>In the above function, we first convert the device coordinates into LED grid coordinates by multiplying both x and y variables by 7. Device coordinates are defined using the number of DNA connectors on the side of the device so for example in the case of a Lightpad Block, the device has a size of 2x2 and therefore the device coordinates will range from 0.0 to 2.0 on each x and y dimensions. Multiplying this range by 7 gives us the LED grid coordinates ranging from 0 to 14 inclusive.</p>
<p>Now using these grid coordinates, we use the <code class="project_code">touchBlob()</code> helper function defined below to check whether the touch event was performed on a previously drawn blob and return its index. If no previous blobs were touched, we return 0 to indicate the creation of a new one.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> touchBlob (<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> touch = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (x &gt;= (blob1x - 1) &amp;&amp; x &lt;= (blob1x + 1) &amp;&amp; y &gt;= (blob1y - 1) &amp;&amp; y &lt;= (blob1y + 1))</div>
<div class="line">    {</div>
<div class="line">        touch = 1;</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">//...</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> touch;</div>
<div class="line">}</div>
</div><!-- fragment --><p>The <code class="project_code">changeBlob()</code> function is called in the <a class="el" href="group__LittleFootFunctions.html#ga1037467281f60ab95f5e5a305a41e73b" title="Called when a touch event starts.">touchStart()</a> callback when an existing blob is touched and updates the index for its direction to update the orientation.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> changeBlob (<span class="keywordtype">int</span> blob)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (blob == 1)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (blob1d &lt; 3)</div>
<div class="line">        {</div>
<div class="line">            ++blob1d;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            blob1d = 0;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">//...</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>If the creation of a new blob was requested from the <a class="el" href="group__LittleFootFunctions.html#ga1037467281f60ab95f5e5a305a41e73b" title="Called when a touch event starts.">touchStart()</a> callback, depending on the pressure of the touch event we spawn a different type of blob at the specified coordinate and call the corresponding function to spawn a bullet.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> assignBlob (<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keywordtype">int</span> index, <span class="keywordtype">int</span> type)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (index == 0)</div>
<div class="line">    {</div>
<div class="line">        blob1x = x;</div>
<div class="line">        blob1y = y;</div>
<div class="line">        blob1d = type;</div>
<div class="line">        spawnBullet1();</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">//...</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>To spawn a bullet we simply assign the coordinates and direction of the blob to the bullet which overwrites the default values and makes the bullet appear within the screen coordinates.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> spawnBullet1()</div>
<div class="line">{</div>
<div class="line">    bullet1x = blob1x;</div>
<div class="line">    bullet1y = blob1y;</div>
<div class="line">    bullet1d = blob1d;</div>
<div class="line">}</div>
<div class="line"><span class="comment">//...</span></div>
</div><!-- fragment --><p>The position of the bullet is updated from the <a class="el" href="group__LittleFootFunctions.html#gac827b978aa122f136a14c198687ad80f" title="Use this method to draw the display.">repaint()</a> function by incrementing or decrementing the corresponding x or y coordinate by the speed variable defined as an IDE parameter which consequently moves the bullet on the screen.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> updateBullet1()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (blob1d == 0)</div>
<div class="line">    {</div>
<div class="line">        bullet1y -= speed;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (blob1d == 1)</div>
<div class="line">    {</div>
<div class="line">        bullet1x += speed;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (blob1d == 2)</div>
<div class="line">    {</div>
<div class="line">        bullet1y += speed;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (blob1d == 3)</div>
<div class="line">    {</div>
<div class="line">        bullet1x -= speed;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"><span class="comment">//...</span></div>
</div><!-- fragment --><div class="image">
<img src="MusicGen.gif" alt=""/>
<div class="caption">
The music generator blobs and bullets</div></div>
<h1><a class="anchor" id="music_gen_generating_midi_messages"></a>
Generating MIDI Messages</h1>
<p>Now that all the visuals are implemented we have to generate some MIDI messages to trigger sounds from the host. The <code class="project_code">detectBullet()</code> function is called periodically in the <a class="el" href="group__LittleFootFunctions.html#gac827b978aa122f136a14c198687ad80f" title="Use this method to draw the display.">repaint()</a> function and performs some basic collision detection.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> detectBullet()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (bullet1x &gt; 15)</div>
<div class="line">    {</div>
<div class="line">        spawnBullet1();</div>
<div class="line">        midiNote (0, 0);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bullet1x &lt; 0 &amp;&amp; bullet1x &gt; -90)</div>
<div class="line">    {</div>
<div class="line">        spawnBullet1();</div>
<div class="line">        midiNote (0, 1);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bullet1y &gt; 15)</div>
<div class="line">    {</div>
<div class="line">        spawnBullet1();</div>
<div class="line">        midiNote (0, 2);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bullet1y &lt; 0 &amp;&amp; bullet1y &gt; -90)</div>
<div class="line">    {</div>
<div class="line">        spawnBullet1();</div>
<div class="line">        midiNote (0, 3);</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">//...</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>Here we check if any of the bullets have crossed the screen boundaries and spawn a new bullet when the old bullet becomes off-screen. Notice here we make sure the default value of -99 defined in the <a class="el" href="group__LittleFootFunctions.html#ga18abf8b19283101238a77c9e6865b673" title="Called when a program is loaded onto the block and is about to start.">initialise()</a> function does not trigger the spawning of a bullet. We also generate a MIDI note by calling the helper function <code class="project_code">midiNote()</code> defined hereafter:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> midiNote(<span class="keywordtype">int</span> note1, <span class="keywordtype">int</span> note2)</div>
<div class="line">{</div>
<div class="line">    note2 *= 12;</div>
<div class="line">    <span class="keywordtype">int</span> note = rootNote;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (note1 == 0)</div>
<div class="line">    {</div>
<div class="line">        note += note2;</div>
<div class="line">        note1 (note);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (note1 == 1)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="namespaceroli_1_1BlocksProtocol.html#a35bcaacfb91f45aa42a778527621f8c4a58483c388ba86112c038309d108dd024">chord</a> == 0)</div>
<div class="line">        {</div>
<div class="line">            note += 4;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            note += 3;</div>
<div class="line">        }</div>
<div class="line">        note += note2;</div>
<div class="line">        note2 (note);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (note1 == 2)</div>
<div class="line">    {</div>
<div class="line">        note += 7;</div>
<div class="line">        note += note2;</div>
<div class="line">        note3 (note);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (note1 == 3)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="namespaceroli_1_1BlocksProtocol.html#a35bcaacfb91f45aa42a778527621f8c4a58483c388ba86112c038309d108dd024">chord</a> == 0)</div>
<div class="line">        {</div>
<div class="line">            note += 11;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            note += 10;</div>
<div class="line">        }</div>
<div class="line">        note += note2;</div>
<div class="line">        note4 (note);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (note1 == 4)</div>
<div class="line">    {</div>
<div class="line">        note += 14;</div>
<div class="line">        note += note2;</div>
<div class="line">        note5 (note);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="anamespaceroli_1_1BlocksProtocol_html_a35bcaacfb91f45aa42a778527621f8c4a58483c388ba86112c038309d108dd024"><div class="ttname"><a href="namespaceroli_1_1BlocksProtocol.html#a35bcaacfb91f45aa42a778527621f8c4a58483c388ba86112c038309d108dd024">roli::BlocksProtocol::chord</a></div><div class="ttdeci">@ chord</div><div class="ttdef"><b>Definition:</b> roli_BlockConfigId.h:59</div></div>
</div><!-- fragment --><p>In order to play a harmonious set of MIDI notes, the above function generates specific notes that form the chord with a root note and major/minor quality as defined in the parameters. It follows a simple set of rules as follows:</p>
<ul>
<li>The index of the blob defines the note in the scale in ascending order: tonic, major or minor third, fifth, major or minor seventh, ninth.</li>
<li>The direction of the blob defines the octave of the note in ascending order: east, west, south, north.</li>
<li>If the chord parameter is set to major, the major third and major seventh are selected forming a major seventh chord.</li>
<li>If the chord parameter is set to minor, the minor third and minor seventh are selected forming a minor seventh chord.</li>
</ul>
<p>The selected note is then passed to the following helper function in order to stop the previously ringing note and start a new one using respectively the <a class="el" href="group__LittleFootFunctions.html#ga2fae47ae2c9c42a76cc6d05b54911263" title="Sends a key-up message.">sendNoteOff()</a> and <a class="el" href="group__LittleFootFunctions.html#gac51d8999177198140b761e3c7166eb69" title="Sends a key-down message.">sendNoteOn()</a> functions with the channel number, the note number and the note velocity as arguments.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> note1 (<span class="keywordtype">int</span> note)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="group__LittleFootFunctions.html#ga2fae47ae2c9c42a76cc6d05b54911263">sendNoteOff</a> (0, lastNote1, 80);</div>
<div class="line">    <a class="code" href="group__LittleFootFunctions.html#gac51d8999177198140b761e3c7166eb69">sendNoteOn</a>  (0,      note, 80);</div>
<div class="line">    lastNote1 = note;</div>
<div class="line">}</div>
<div class="line"><span class="comment">//...</span></div>
<div class="ttc" id="agroup__LittleFootFunctions_html_ga2fae47ae2c9c42a76cc6d05b54911263"><div class="ttname"><a href="group__LittleFootFunctions.html#ga2fae47ae2c9c42a76cc6d05b54911263">sendNoteOff</a></div><div class="ttdeci">void sendNoteOff(int channel, int noteNumber, int velocity)</div><div class="ttdoc">Sends a key-up message.</div></div>
<div class="ttc" id="agroup__LittleFootFunctions_html_gac51d8999177198140b761e3c7166eb69"><div class="ttname"><a href="group__LittleFootFunctions.html#gac51d8999177198140b761e3c7166eb69">sendNoteOn</a></div><div class="ttdeci">void sendNoteOn(int channel, int noteNumber, int velocity)</div><div class="ttdoc">Sends a key-down message.</div></div>
</div><!-- fragment --><h1><a class="anchor" id="music_gen_summary"></a>
Summary</h1>
<p>In this example, we learnt how to create a music generator app that sends MIDI messages to a host.</p>
<h1><a class="anchor" id="music_gen_see_also"></a>
See also</h1>
<ul>
<li><a class="el" href="example_dynamic_parameters.html">Dynamic Parameters</a></li>
<li><a class="el" href="example_colour_pressure_map.html">Colour Pressure Map</a></li>
<li><a class="el" href="example_tic_tac_toe.html">Tic Tac Toe</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<hr class="footer"/>
<address class="footer"><small>All content &copy ROLI Ltd.</small></address><br/>
</body>
</html>
