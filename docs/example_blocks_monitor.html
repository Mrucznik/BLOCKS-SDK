<!-- HTML header for doxygen 1.8.12-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>The BLOCKS SDK: BlocksMonitor</title>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">The BLOCKS SDK
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('example_blocks_monitor.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">BlocksMonitor </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="blocks_monitor_introduction"></a>
Introduction</h1>
<p>BlocksMonitor is a simple JUCE application that shows currently connected Lightpad and Control Block devices and visualises touches and button presses. It also displays some basic information about the Blocks.</p>
<p>Generate a Projucer project from the file located in the <code class="filename">examples/</code> folder, then navigate to the <code class="filename">BlocksMonitorDemo/Builds/</code> directory and open the code project in your IDE of choice. Run the application and connect your Blocks (if you do not know how to do this, see <a class="el" href="connecting_blocks.html">Connecting BLOCKS</a>). Any devices that you have connected should now show up in the application window and this display will be updated as you add and remove Blocks. Lightpads are represented as a black square and will display the current touches as coloured circles, the size of which depend on the touch pressure, and Control Blocks are shown as rectangles containing the LED row and clickable buttons on the hardware. If you hover the mouse cursor over a Block, a tooltip will appear displaying the name, UID, serial number and current battery level.</p>
<div class="image">
<img src="BlocksMonitor.png" alt=""/>
<div class="caption">
The BlocksMonitor application with a Lightpad and 3 Control Blocks connected</div></div>
<h1><a class="anchor" id="blocks_monitor_topology"></a>
Topology</h1>
<p>One of the fundamental concepts of the BLOCKS API is topology - a topology is a set of physically connected Blocks and the connections between them. Knowing when the topology has changed and accessing a data structure containing the current topology is the basis of any Blocks application.</p>
<p>To access the current topology, <code class="project_code">BlocksMonitorDemo</code> inherits from the <a class="el" href="structTopologySource_1_1Listener.html" title="Used to receive callbacks for topology changes.">TopologySource::Listener</a> base class <span class="comment">[1]</span> and implements the <a class="el" href="structTopologySource_1_1Listener.html#afe9485086e5d66f70a0a7990582081c2" title="Called for any change in topology - devices changed, connections changed, etc.">TopologySource::Listener::topologyChanged()</a> method <span class="comment">[2]</span>, a callback which is used to inform listeners when any physical devices have been added or removed.</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>BlocksMonitorDemo   : <span class="keyword">public</span> Component,</div>
<div class="line">                            <span class="keyword">public</span> <a class="code" href="structTopologySource_1_1Listener.html">TopologySource::Listener</a>, <span class="comment">// [1]</span></div>
<div class="line">                            <span class="keyword">private</span> Timer</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line"><span class="comment">//...</span></div>
<div class="line">    <span class="keywordtype">void</span> <a class="code" href="structTopologySource_1_1Listener.html#afe9485086e5d66f70a0a7990582081c2">topologyChanged</a>() override                          <span class="comment">// [2]</span></div>
<div class="line">    {</div>
<div class="line">    <span class="comment">//...</span></div>
<div class="ttc" id="astructTopologySource_1_1Listener_html"><div class="ttname"><a href="structTopologySource_1_1Listener.html">TopologySource::Listener</a></div><div class="ttdoc">Used to receive callbacks for topology changes.</div><div class="ttdef"><b>Definition:</b> roli_TopologySource.h:51</div></div>
<div class="ttc" id="astructTopologySource_1_1Listener_html_afe9485086e5d66f70a0a7990582081c2"><div class="ttname"><a href="structTopologySource_1_1Listener.html#afe9485086e5d66f70a0a7990582081c2">TopologySource::Listener::topologyChanged</a></div><div class="ttdeci">virtual void topologyChanged()</div><div class="ttdoc">Called for any change in topology - devices changed, connections changed, etc.</div><div class="ttdef"><b>Definition:</b> roli_TopologySource.h:55</div></div>
</div><!-- fragment --><p>In order to receive these callbacks, <code class="project_code">BlocksMonitorDemo</code> contains an instance of the <a class="el" href="classPhysicalTopologySource.html" title="This topology source manages the topology of the physical Blocks devices that are currently connected...">PhysicalTopologySource</a> class <span class="comment">[3]</span> and registers itself as a listener to this object in its constructor <span class="comment">[4]</span>.</p>
<div class="fragment"><div class="line">    BlocksMonitorDemo()</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">//...</span></div>
<div class="line">        topologySource.addListener (<span class="keyword">this</span>);          <span class="comment">// [4]</span></div>
<div class="line">        <span class="comment">//...</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    <span class="comment">//...</span></div>
<div class="line">    <a class="code" href="classPhysicalTopologySource.html">PhysicalTopologySource</a> topologySource;          <span class="comment">// [3]</span></div>
<div class="line">    OwnedArray&lt;BlockComponent&gt; blockComponents;</div>
<div class="line">    BlockComponent* masterBlockComponent = <span class="keyword">nullptr</span>;</div>
<div class="line"><span class="comment">//...</span></div>
<div class="ttc" id="aclassPhysicalTopologySource_html"><div class="ttname"><a href="classPhysicalTopologySource.html">PhysicalTopologySource</a></div><div class="ttdoc">This topology source manages the topology of the physical Blocks devices that are currently connected...</div><div class="ttdef"><b>Definition:</b> roli_PhysicalTopologySource.h:33</div></div>
</div><!-- fragment --><p>When the <code class="project_code">topologyChanged()</code> method is called, this object can be used to access the updated topology through the <a class="el" href="classPhysicalTopologySource.html#a5b05bfe7c015f971273087312d21ea89" title="Returns the current physical topology.">PhysicalTopologySource::getCurrentTopology()</a> method <span class="comment">[5]</span> which returns a <a class="el" href="structBlockTopology.html" title="Describes a set of blocks and the connections between them.">BlockTopology</a> struct containing an array of currently connected <a class="el" href="classBlock.html" title="Represents an individual BLOCKS device.">Block</a> objects and an array of <a class="el" href="structBlockDeviceConnection.html" title="Describes a physical connection between two ports of two block devices.">BlockDeviceConnection</a> structs representing the connections between them.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> topologyChanged()<span class="keyword"> override</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">    <span class="comment">//...</span></div>
<div class="line">    <span class="keyword">auto</span> topology = topologySource.<a class="code" href="classPhysicalTopologySource.html#a5b05bfe7c015f971273087312d21ea89">getCurrentTopology</a>(); <span class="comment">// [5]</span></div>
<div class="line">    <span class="comment">//...</span></div>
<div class="line">}</div>
<div class="ttc" id="aclassPhysicalTopologySource_html_a5b05bfe7c015f971273087312d21ea89"><div class="ttname"><a href="classPhysicalTopologySource.html#a5b05bfe7c015f971273087312d21ea89">PhysicalTopologySource::getCurrentTopology</a></div><div class="ttdeci">BlockTopology getCurrentTopology() const override</div><div class="ttdoc">Returns the current physical topology.</div></div>
</div><!-- fragment --><h1><a class="anchor" id="blocks_monitor_block_object"></a>
The Block Object</h1>
<p>The array of Block objects contained in the BlockTopology struct can be used to access individual Block objects <span class="comment">[1]</span> and determine their type using the <a class="el" href="classBlock.html#aa09e9ff13441f8c6689acb398870c715" title="Returns the type of this device.">Block::getType()</a> method <span class="comment">[2]</span>.</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; block : topology.blocks) <span class="comment">// [1]</span></div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (<span class="keyword">auto</span>* blockComponent = createBlockComponent (block))</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">//...</span></div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>The application uses this information to construct an on-screen representation of the currently connected Blocks by creating either a <code class="project_code">LightpadComponent</code> object <span class="comment">[3]</span> or a <code class="project_code">ControlBlockComponent</code> object <span class="comment">[4]</span> for each Block in the current topology.</p>
<div class="fragment"><div class="line">BlockComponent* createBlockComponent (<a class="code" href="classBlock.html#ab9125d8b89e8f6e121e6342ccfb96aec">Block::Ptr</a> newBlock)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">auto</span> type = newBlock-&gt;getType();                 <span class="comment">// [2]</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (type == <a class="code" href="classBlock.html#a2c6b3c425b9b8cb708b23e553fa81324ae901f3708edf53ccf96ff94ff361a3fa">Block::lightPadBlock</a>)</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">new</span> LightpadComponent (newBlock);     <span class="comment">// [3]</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (type == <a class="code" href="classBlock.html#a2c6b3c425b9b8cb708b23e553fa81324a53a61b7ffc6c027d254d52373a5d2d2b">Block::loopBlock</a> || type == <a class="code" href="classBlock.html#a2c6b3c425b9b8cb708b23e553fa81324a93f75ccb833781bd24f8ad1755da25e3">Block::liveBlock</a></div>
<div class="line">        || type == <a class="code" href="classBlock.html#a2c6b3c425b9b8cb708b23e553fa81324a96792e301d0fbaeea7e35a88b1bbb054">Block::touchBlock</a> || type == <a class="code" href="classBlock.html#a2c6b3c425b9b8cb708b23e553fa81324a98ca592426170135a53fdd46bc6d2a53">Block::developerControlBlock</a>)</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">new</span> ControlBlockComponent (newBlock); <span class="comment">// [4]</span></div>
<div class="line"> </div>
<div class="line">    jassertfalse;</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line">}</div>
<div class="ttc" id="aclassBlock_html_a2c6b3c425b9b8cb708b23e553fa81324a53a61b7ffc6c027d254d52373a5d2d2b"><div class="ttname"><a href="classBlock.html#a2c6b3c425b9b8cb708b23e553fa81324a53a61b7ffc6c027d254d52373a5d2d2b">Block::loopBlock</a></div><div class="ttdeci">@ loopBlock</div><div class="ttdoc">Loop control block type.</div><div class="ttdef"><b>Definition:</b> roli_Block.h:45</div></div>
<div class="ttc" id="aclassBlock_html_a2c6b3c425b9b8cb708b23e553fa81324a93f75ccb833781bd24f8ad1755da25e3"><div class="ttname"><a href="classBlock.html#a2c6b3c425b9b8cb708b23e553fa81324a93f75ccb833781bd24f8ad1755da25e3">Block::liveBlock</a></div><div class="ttdeci">@ liveBlock</div><div class="ttdoc">Live control block type.</div><div class="ttdef"><b>Definition:</b> roli_Block.h:44</div></div>
<div class="ttc" id="aclassBlock_html_a2c6b3c425b9b8cb708b23e553fa81324a96792e301d0fbaeea7e35a88b1bbb054"><div class="ttname"><a href="classBlock.html#a2c6b3c425b9b8cb708b23e553fa81324a96792e301d0fbaeea7e35a88b1bbb054">Block::touchBlock</a></div><div class="ttdeci">@ touchBlock</div><div class="ttdoc">Touch control block type.</div><div class="ttdef"><b>Definition:</b> roli_Block.h:47</div></div>
<div class="ttc" id="aclassBlock_html_a2c6b3c425b9b8cb708b23e553fa81324a98ca592426170135a53fdd46bc6d2a53"><div class="ttname"><a href="classBlock.html#a2c6b3c425b9b8cb708b23e553fa81324a98ca592426170135a53fdd46bc6d2a53">Block::developerControlBlock</a></div><div class="ttdeci">@ developerControlBlock</div><div class="ttdoc">Developer control block type.</div><div class="ttdef"><b>Definition:</b> roli_Block.h:46</div></div>
<div class="ttc" id="aclassBlock_html_a2c6b3c425b9b8cb708b23e553fa81324ae901f3708edf53ccf96ff94ff361a3fa"><div class="ttname"><a href="classBlock.html#a2c6b3c425b9b8cb708b23e553fa81324ae901f3708edf53ccf96ff94ff361a3fa">Block::lightPadBlock</a></div><div class="ttdeci">@ lightPadBlock</div><div class="ttdoc">Lightpad block type.</div><div class="ttdef"><b>Definition:</b> roli_Block.h:43</div></div>
<div class="ttc" id="aclassBlock_html_ab9125d8b89e8f6e121e6342ccfb96aec"><div class="ttname"><a href="classBlock.html#ab9125d8b89e8f6e121e6342ccfb96aec">Block::Ptr</a></div><div class="ttdeci">juce::ReferenceCountedObjectPtr&lt; Block &gt; Ptr</div><div class="ttdoc">The Block class is reference-counted, so always use a Block::Ptr when you are keeping references to t...</div><div class="ttdef"><b>Definition:</b> roli_Block.h:59</div></div>
</div><!-- fragment --><p>Both of these classes derive from <code class="project_code">BlockComponent</code>, a relatively simple base class that contains some virtual functions for painting the Block on screen and handling callbacks from the touch surface and/or buttons on the Block.</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>BlockComponent : <span class="keyword">public</span> Component,</div>
<div class="line">                       <span class="comment">//...</span></div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="comment">//...</span></div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> paint (Graphics&amp;) <span class="keyword">override</span> = 0;</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> handleButtonPressed  (<a class="code" href="classControlButton.html#a891776295057786f99f14631b1aa2794">ControlButton::ButtonFunction</a>, <a class="code" href="namespacelittlefoot.html#a417dab5137c6d4ff4e23303f84099aa9">uint32</a>) {}</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> handleButtonReleased (<a class="code" href="classControlButton.html#a891776295057786f99f14631b1aa2794">ControlButton::ButtonFunction</a>, <a class="code" href="namespacelittlefoot.html#a417dab5137c6d4ff4e23303f84099aa9">uint32</a>) {}</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> handleTouchChange (<a class="code" href="structTouchSurface_1_1Touch.html">TouchSurface::Touch</a>) {}</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> handleBatteryLevelUpdate (<span class="keywordtype">float</span>) {}</div>
<div class="line">    <span class="comment">//...</span></div>
<div class="ttc" id="aclassControlButton_html_a891776295057786f99f14631b1aa2794"><div class="ttname"><a href="classControlButton.html#a891776295057786f99f14631b1aa2794">ControlButton::ButtonFunction</a></div><div class="ttdeci">ButtonFunction</div><div class="ttdoc">These are all known types of control buttons.</div><div class="ttdef"><b>Definition:</b> roli_ControlButton.h:43</div></div>
<div class="ttc" id="anamespacelittlefoot_html_a417dab5137c6d4ff4e23303f84099aa9"><div class="ttname"><a href="namespacelittlefoot.html#a417dab5137c6d4ff4e23303f84099aa9">littlefoot::uint32</a></div><div class="ttdeci">unsigned int uint32</div><div class="ttdef"><b>Definition:</b> roli_LittleFootRunner.h:48</div></div>
<div class="ttc" id="astructTouchSurface_1_1Touch_html"><div class="ttname"><a href="structTouchSurface_1_1Touch.html">TouchSurface::Touch</a></div><div class="ttdoc">Structure used to describe touch properties.</div><div class="ttdef"><b>Definition:</b> roli_TouchSurface.h:41</div></div>
</div><!-- fragment --><p>In its constructor, <code class="project_code">BlockComponent</code> takes a pointer to the Block object that it represents and adds itself as a listener to the touch surface (if it is a Lightpad) and buttons using the <a class="el" href="classBlock.html#aa70fa4170ec51dc2e78c0ff03fb12592" title="If this block has a pressure-sensitive surface, this will return an object to access its data.">Block::getTouchSurface()</a> and <a class="el" href="classBlock.html#acc23b0d9ec2fb2c250a3b120da0dc337" title="If this block has any control buttons, this will return an array of objects to control them.">Block::getButtons()</a> methods, respectively.</p>
<div class="fragment"><div class="line">BlockComponent (<a class="code" href="classBlock.html#ab9125d8b89e8f6e121e6342ccfb96aec">Block::Ptr</a> blockToUse)</div>
<div class="line">    : block (blockToUse)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">//...</span></div>
<div class="line">    <span class="keywordflow">if</span> (<span class="keyword">auto</span> touchSurface = block-&gt;getTouchSurface())</div>
<div class="line">        touchSurface-&gt;addListener (<span class="keyword">this</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> button : block-&gt;getButtons())</div>
<div class="line">        button-&gt;addListener (<span class="keyword">this</span>);</div>
<div class="line">    <span class="comment">//...</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>It inherits from the <a class="el" href="structTouchSurface_1_1Listener.html" title="Receives callbacks when a touch moves or changes pressure.">TouchSurface::Listener</a> and <a class="el" href="structControlButton_1_1Listener.html" title="A listener that can be attached to a ControlButton object so that it gets called when the button is p...">ControlButton::Listener</a> classes and overrides the <a class="el" href="structTouchSurface_1_1Listener.html#a0015308f21df83dd0fbbf93027970409">TouchSurface::Listener::touchChanged()</a>, <a class="el" href="structControlButton_1_1Listener.html#aa324925eb2c059abd9b967c9ba98cd95" title="Called when the button is pressed.">ControlButton::Listener::buttonPressed()</a> and <a class="el" href="structControlButton_1_1Listener.html#ac327990c17308209cfa919d70f7623b3" title="Called when the button is released.">ControlButton::Listener::buttonReleased()</a> methods to call its own virtual methods, which are implemented by the <code class="project_code">LightpadComponent</code> and <code class="project_code">ControlBlockComponent</code> classes to update the on-screen components.</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>BlockComponent : <span class="keyword">public</span> Component,</div>
<div class="line">                       <span class="keyword">public</span> SettableTooltipClient,</div>
<div class="line">                       <span class="keyword">private</span> <a class="code" href="structTouchSurface_1_1Listener.html">TouchSurface::Listener</a>,</div>
<div class="line">                       <span class="keyword">private</span> <a class="code" href="structControlButton_1_1Listener.html">ControlButton::Listener</a>,</div>
<div class="line">                       <span class="keyword">private</span> Timer</div>
<div class="line">{</div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    <span class="comment">//...</span></div>
<div class="line">    <span class="keywordtype">void</span> touchChanged (<a class="code" href="classTouchSurface.html">TouchSurface</a>&amp;, <span class="keyword">const</span> <a class="code" href="structTouchSurface_1_1Touch.html">TouchSurface::Touch</a>&amp; t)<span class="keyword"> override </span>{ handleTouchChange (t); }</div>
<div class="line">    <span class="keywordtype">void</span> buttonPressed  (<a class="code" href="classControlButton.html">ControlButton</a>&amp; b, <a class="code" href="classBlock.html#a5359516407a1e9ada9d17c47e8346f2e">Block::Timestamp</a> t)<span class="keyword"> override      </span>{ handleButtonPressed  (b.<a class="code" href="classControlButton.html#a41db526f8540d3cb9300ca2b19a45cfd">getType</a>(), t); }</div>
<div class="line">    <span class="keywordtype">void</span> buttonReleased (<a class="code" href="classControlButton.html">ControlButton</a>&amp; b, <a class="code" href="classBlock.html#a5359516407a1e9ada9d17c47e8346f2e">Block::Timestamp</a> t)<span class="keyword"> override      </span>{ handleButtonReleased (b.<a class="code" href="classControlButton.html#a41db526f8540d3cb9300ca2b19a45cfd">getType</a>(), t); }</div>
<div class="line">    <span class="comment">//...</span></div>
<div class="ttc" id="aclassBlock_html_a5359516407a1e9ada9d17c47e8346f2e"><div class="ttname"><a href="classBlock.html#a5359516407a1e9ada9d17c47e8346f2e">Block::Timestamp</a></div><div class="ttdeci">juce::uint32 Timestamp</div><div class="ttdoc">This type is used for timestamping events.</div><div class="ttdef"><b>Definition:</b> roli_Block.h:539</div></div>
<div class="ttc" id="aclassControlButton_html"><div class="ttname"><a href="classControlButton.html">ControlButton</a></div><div class="ttdoc">Represents a button on a block device.</div><div class="ttdef"><b>Definition:</b> roli_ControlButton.h:31</div></div>
<div class="ttc" id="aclassControlButton_html_a41db526f8540d3cb9300ca2b19a45cfd"><div class="ttname"><a href="classControlButton.html#a41db526f8540d3cb9300ca2b19a45cfd">ControlButton::getType</a></div><div class="ttdeci">virtual ButtonFunction getType() const =0</div><div class="ttdoc">Returns the button's type.</div></div>
<div class="ttc" id="aclassTouchSurface_html"><div class="ttname"><a href="classTouchSurface.html">TouchSurface</a></div><div class="ttdoc">Represents the touch surface of a BLOCKS device.</div><div class="ttdef"><b>Definition:</b> roli_TouchSurface.h:31</div></div>
<div class="ttc" id="astructControlButton_1_1Listener_html"><div class="ttname"><a href="structControlButton_1_1Listener.html">ControlButton::Listener</a></div><div class="ttdoc">A listener that can be attached to a ControlButton object so that it gets called when the button is p...</div><div class="ttdef"><b>Definition:</b> roli_ControlButton.h:117</div></div>
<div class="ttc" id="astructTouchSurface_1_1Listener_html"><div class="ttname"><a href="structTouchSurface_1_1Listener.html">TouchSurface::Listener</a></div><div class="ttdoc">Receives callbacks when a touch moves or changes pressure.</div><div class="ttdef"><b>Definition:</b> roli_TouchSurface.h:108</div></div>
</div><!-- fragment --><p>To visualise touches on the Lightpad, <code class="project_code">LightpadComponent</code> contains an instance of the <a class="el" href="classTouchList.html" title="Utility class to hold a list of TouchSurface::Touch objects with different indices and blockUIDs,...">TouchList</a> class called <code class="project_code">touches</code> and calls the <a class="el" href="classTouchList.html#a9f927c25bb5abfea37670b6369077dbc" title="Updates the entry for the given touch, copying in the new state.">TouchList::updateTouch()</a> method whenever it receives a touch surface listener callback in the <code class="project_code">LightpadComponent::handleTouchChange()</code> method.</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>LightpadComponent   : <span class="keyword">public</span> BlockComponent</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="comment">//...</span></div>
<div class="line">    <span class="keywordtype">void</span> handleTouchChange (<a class="code" href="structTouchSurface_1_1Touch.html">TouchSurface::Touch</a> touch)<span class="keyword"> override </span>{ touches.updateTouch (touch); }</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    <span class="comment">//...</span></div>
<div class="line">    <a class="code" href="classTouchList.html">TouchList&lt;TouchSurface::Touch&gt;</a> touches;</div>
<div class="line">    <span class="comment">//...</span></div>
<div class="ttc" id="aclassTouchList_html"><div class="ttname"><a href="classTouchList.html">TouchList</a></div><div class="ttdoc">Utility class to hold a list of TouchSurface::Touch objects with different indices and blockUIDs,...</div><div class="ttdef"><b>Definition:</b> roli_TouchList.h:37</div></div>
</div><!-- fragment --><p>The <code class="project_code">LightpadBlock::paint()</code> method then iterates over the current <a class="el" href="structTouchSurface_1_1Touch.html" title="Structure used to describe touch properties.">TouchSurface::Touch</a> objects in the TouchList and visualises them on the component at 25Hz.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> paint (Graphics&amp; g)<span class="keyword"> override</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">    <span class="comment">//...</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> touch : touches)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">//...</span></div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>The <code class="project_code">ControlBlockComponent</code> class represents a generic Control Block with 15 LEDs, 8 circular buttons and 1 rounded rectangular button. When a button is pressed on the physical Control Block, the <code class="project_code">BlockComponent::handleButtonPressed()</code> function is called and this class uses the <a class="el" href="classControlButton.html#a891776295057786f99f14631b1aa2794" title="These are all known types of control buttons.">ControlButton::ButtonFunction</a> variable to determine which button was pressed and should be activated on the on-screen component.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> handleButtonPressed  (<a class="code" href="classControlButton.html#a891776295057786f99f14631b1aa2794">ControlButton::ButtonFunction</a> <span class="keyword">function</span>, <a class="code" href="namespacelittlefoot.html#a417dab5137c6d4ff4e23303f84099aa9">uint32</a>)<span class="keyword"> override</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">    displayButtonInteraction (controlButtonFunctionToIndex (<span class="keyword">function</span>), <span class="keyword">true</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><p>The same process is repeated for when the button is released.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> handleButtonReleased (<a class="code" href="classControlButton.html#a891776295057786f99f14631b1aa2794">ControlButton::ButtonFunction</a> <span class="keyword">function</span>, <a class="code" href="namespacelittlefoot.html#a417dab5137c6d4ff4e23303f84099aa9">uint32</a>)<span class="keyword"> override</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">    displayButtonInteraction (controlButtonFunctionToIndex (<span class="keyword">function</span>), <span class="keyword">false</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><p>This class also overrides the <code class="project_code">BlockComponent::handleBatteryLevelUpdate()</code> method to update which LEDs should be on based on the battery level, which is accessed in the <code class="project_code">BlockComponent</code> base class using the <a class="el" href="classBlock.html#a0921046ac4cabfb90e614d430be3c4d2" title="Returns the battery level in the range 0.0 to 1.0.">Block::getBatteryLevel()</a> and <a class="el" href="classBlock.html#ae1e9122a7d34c5a7588280d948ac8733" title="Returns true if the battery is charging.">Block::isBatteryCharging()</a> methods.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> handleBatteryLevelUpdate (<span class="keywordtype">float</span> batteryLevel)<span class="keyword"> override</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">    <span class="keyword">auto</span> numLedsOn = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span> (numLeds * batteryLevel);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (numLedsOn != previousNumLedsOn)</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">auto</span> i = 0; i &lt; numLeds; ++i)</div>
<div class="line">            leds.getUnchecked (i)-&gt;setOnState (i &lt; numLedsOn);</div>
<div class="line"> </div>
<div class="line">    previousNumLedsOn = numLedsOn;</div>
<div class="line">    <a class="code" href="group__LittleFootFunctions.html#gac827b978aa122f136a14c198687ad80f">repaint</a>();</div>
<div class="line">}</div>
<div class="ttc" id="agroup__LittleFootFunctions_html_gac827b978aa122f136a14c198687ad80f"><div class="ttname"><a href="group__LittleFootFunctions.html#gac827b978aa122f136a14c198687ad80f">repaint</a></div><div class="ttdeci">void repaint()</div><div class="ttdoc">Use this method to draw the display.</div></div>
</div><!-- fragment --><p>These callback methods are a simple and powerful way to get user input from the Blocks and use this data to drive some process in your application. In this example, the input is simply mirrored on the screen but it could be used to control any number of things such as audio synthesis (see the <a class="el" href="example_blocks_synth.html">BlocksSynth</a> example) and graphics (see the <a class="el" href="example_blocks_drawing.html">BlocksDrawing</a> example).</p>
<h1><a class="anchor" id="blocks_monitor_connections"></a>
Blocks Connections</h1>
<p>The BlockTopology struct returned by the <code class="project_code">PhysicalTopologySource::getCurrentTopology()</code> method also contains an array of <a class="el" href="structBlockDeviceConnection.html" title="Describes a physical connection between two ports of two block devices.">BlockDeviceConnection</a> objects representing all the current DNA port connections between Blocks in the topology. A single BlockDeviceConnection struct describes a physical connection between two ports on two Blocks and contains a <a class="el" href="classBlock.html#a37ebdbbb58dd7692a537085f430da347" title="This type is used for the unique block identifier.">Block::UID</a> and <a class="el" href="structBlock_1_1ConnectionPort.html" title="These are the edge-connectors that a device may have.">Block::ConnectionPort</a> object for each of the two devices.</p>
<p>This information is used to calculate the position and rotation of each connected Block and update the corresponding <code class="project_code">topLeft</code> and <code class="project_code">rotation</code> member variables of its <code class="project_code">BlockComponent</code> so that the correct topology is displayed on the screen. The <code class="project_code">topLeft</code> variable is a Point that describes the position of the top left of the <code class="project_code">BlockComponent</code> in terms of logical device units relative to the top left of the master Block at Point (0, 0).</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> rotation = 0;</div>
<div class="line">Point&lt;float&gt; topLeft = { 0.0f, 0.0f };</div>
</div><!-- fragment --><p>Initially, all <code class="project_code">BlockComponent</code> instances have the <code class="project_code">topLeft</code> position (0, 0) and the <code class="project_code">BlocksMonitorDemo::positionBlocks()</code> method iterates first over all of the Blocks connected to the master Block and then any remaining Blocks and calculates the correct <code class="project_code">topLeft</code> Point and <code class="project_code">rotation</code> for each using the array of BlockDeviceConnection objects.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> positionBlocks (<a class="code" href="structBlockTopology.html">BlockTopology</a> topology)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">//...</span></div>
<div class="line">    Array&lt;BlockDeviceConnection&gt; masterBlockConnections;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> connection : topology.<a class="code" href="structBlockTopology.html#a13c44d0f739830ed25c65eed8321aa28">connections</a>)</div>
<div class="line">        <span class="keywordflow">if</span> (connection.device1 == masterBlockComponent-&gt;block-&gt;uid || connection.device2 == masterBlockComponent-&gt;block-&gt;uid)</div>
<div class="line">            masterBlockConnections.add (connection);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">while</span> (maxDelta &gt; 0.001f &amp;&amp; --maxLoops)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">//...</span></div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">auto</span> connection : masterBlockConnections)</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">//...</span></div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keyword">auto</span> otherBlockComponent : blockComponents)</div>
<div class="line">            {</div>
<div class="line">                <span class="comment">//...</span></div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    Array&lt;BlockComponent*&gt; unpositionedBlocks;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> blockComponent : blockComponents)</div>
<div class="line">        <span class="keywordflow">if</span> (blockComponent != masterBlockComponent &amp;&amp; ! blocksConnectedToMaster.contains (blockComponent))</div>
<div class="line">            unpositionedBlocks.add (blockComponent);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (unpositionedBlocks.size() &gt; 0)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">//...</span></div>
<div class="line">        <span class="keywordflow">while</span> (maxDelta &gt; 0.001f &amp;&amp; --maxLoops)</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">//...</span></div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keyword">auto</span> blockComponent : unpositionedBlocks)</div>
<div class="line">            {</div>
<div class="line">                Array&lt;BlockDeviceConnection&gt; blockConnections;</div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keyword">auto</span> connection : topology.<a class="code" href="structBlockTopology.html#a13c44d0f739830ed25c65eed8321aa28">connections</a>)</div>
<div class="line">                    <span class="keywordflow">if</span> (connection.device1 == blockComponent-&gt;block-&gt;uid || connection.device2 == blockComponent-&gt;block-&gt;uid)</div>
<div class="line">                        blockConnections.add (connection);</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keyword">auto</span> connection : blockConnections)</div>
<div class="line">                {</div>
<div class="line">                    <span class="comment">//...</span></div>
<div class="line">                    <span class="keywordflow">for</span> (<span class="keyword">auto</span> otherBlockComponent : blockComponents)</div>
<div class="line">                    {</div>
<div class="line">                        <span class="comment">//...</span></div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="astructBlockTopology_html"><div class="ttname"><a href="structBlockTopology.html">BlockTopology</a></div><div class="ttdoc">Describes a set of blocks and the connections between them.</div><div class="ttdef"><b>Definition:</b> roli_Topology.h:44</div></div>
<div class="ttc" id="astructBlockTopology_html_a13c44d0f739830ed25c65eed8321aa28"><div class="ttname"><a href="structBlockTopology.html#a13c44d0f739830ed25c65eed8321aa28">BlockTopology::connections</a></div><div class="ttdeci">juce::Array&lt; BlockDeviceConnection &gt; connections</div><div class="ttdef"><b>Definition:</b> roli_Topology.h:46</div></div>
</div><!-- fragment --><p>Then, in the <code class="project_code">BlocksMonitorDemo::resized()</code> method these attributes are used to correctly position the components.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> resized()<span class="keyword"> override</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">    <span class="comment">//...</span></div>
<div class="line">    <span class="keywordflow">if</span> (numBlockComponents == 0)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">//...</span></div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//...</span></div>
<div class="line">    <span class="keywordflow">if</span> (isInitialResized)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">//...</span></div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">auto</span> blockComponent : blockComponents)</div>
<div class="line">        {</div>
<div class="line">            <span class="keyword">auto</span> topLeft = blockComponent-&gt;topLeft;</div>
<div class="line">            <span class="keyword">auto</span> rotation = blockComponent-&gt;rotation;</div>
<div class="line">            <span class="comment">//...</span></div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">//...</span></div>
<div class="line">        masterBlockComponent-&gt;centreWithSize (...);</div>
<div class="line">        <span class="comment">//...</span></div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        masterBlockComponent-&gt;setSize (...);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> blockComponent : blockComponents)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (blockComponent == masterBlockComponent)</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line"> </div>
<div class="line">        blockComponent-&gt;setBounds (...);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (blockComponent-&gt;rotation != 0)</div>
<div class="line">            blockComponent-&gt;setTransform (AffineTransform::rotation (...));</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="blocks_monitor_summary"></a>
Summary</h1>
<p>This tutorial and the accompanying code has introduced the BlockTopology and Block objects, and demonstrated how to receive callbacks from connected Blocks when the touch surface or buttons are pressed, allowing you to use this input in your own applications.</p>
<h1><a class="anchor" id="blocks_monitor_see_also"></a>
See also</h1>
<ul>
<li><a class="el" href="example_blocks_drawing.html">BlocksDrawing</a></li>
<li><a class="el" href="example_blocks_synth.html">BlocksSynth</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<hr class="footer"/>
<address class="footer"><small>All content &copy ROLI Ltd.</small></address><br/>
</body>
</html>
